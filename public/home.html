<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindful Moments - Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Mindful Moments</h1>
        <nav>
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
                <li><a href="#" id="logout-link">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="mood-tracker">
            <h2>How are you feeling today?</h2>
            <div id="current-mood">
                <!-- Display current mood here -->
            </div>
            <div class="mood-buttons">
                <button onclick="updateMood('Happy', 'ðŸ˜Š')">ðŸ˜Š Happy</button>
                <button onclick="updateMood('Sad', 'ðŸ˜¢')">ðŸ˜¢ Sad</button>
                <button onclick="updateMood('Anxious', 'ðŸ˜Ÿ')">ðŸ˜Ÿ Anxious</button>
                <button onclick="updateMood('Calm', 'ðŸ˜Œ')">ðŸ˜Œ Calm</button>
            </div>
        </section>

        <section id="journal">
            <h2>Today's Journal</h2>
            <textarea id="journal-entry" placeholder="Write about your day..."></textarea>
            <button id="save-journal">Save Entry</button>
        </section>

        <section id="affirmations">
            <h2>Daily Affirmation</h2>
            <p id="affirmation-text">I am capable of handling anything that comes my way.</p>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Mindful Moments</p>
    </footer>

    <div id="notification" class="notification">
        <span id="notification-message"></span>
    </div>

    <script>
        // Utility functions - Updated to use backend API
const API_BASE_URL = 'http://localhost:3000/api';

function getAuthHeaders() {
    const token = localStorage.getItem('mindful_token');
    return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
    };
}

function getCurrentUser() {
    const user = localStorage.getItem("mindful_current_user");
    return user ? JSON.parse(user) : null;
}

function checkAuth() {
    const token = localStorage.getItem('mindful_token');
    const currentUser = getCurrentUser();
    
    if (!token || !currentUser) {
        window.location.href = "login.html";
        return false;
    }
    return true;
}

function logout() {
    if (confirm("Are you sure you want to logout?")) {
        localStorage.removeItem("mindful_token");
        localStorage.removeItem("mindful_current_user");
        window.location.href = "login.html";
    }
}

// Update the mood tracking function to use the API
async function updateMood(mood, emoji) {
    try {
        const today = new Date().toISOString().split('T')[0];
        const response = await fetch(`${API_BASE_URL}/mood`, {
            method: 'POST',
            headers: getAuthHeaders(),
            body: JSON.stringify({ mood, emoji, date: today }),
        });

        if (response.ok) {
            showNotification(`Mood updated to ${mood} ${emoji}`, 'success');
            loadTodayMood();
        } else {
            const error = await response.json();
            showNotification(error.error || 'Failed to update mood', 'error');
        }
    } catch (error) {
        console.error('Mood update error:', error);
        showNotification('Network error. Please try again.', 'error');
    }
}

// Update the load today's mood function
async function loadTodayMood() {
    try {
        const today = new Date().toISOString().split('T')[0];
        const response = await fetch(`${API_BASE_URL}/mood?date=${today}`, {
            headers: getAuthHeaders(),
        });

        if (response.ok) {
            const moods = await response.json();
            const todayMood = moods.find(m => m.date === today);
            
            if (todayMood) {
                document.getElementById('current-mood').innerHTML = `
                    <span class="mood-display">${todayMood.emoji} ${todayMood.mood}</span>
                `;
            }
        }
    } catch (error) {
        console.error('Load mood error:', error);
    }
}
        
        // Notification function
        function showNotification(message, type = 'info') {
            const notificationDiv = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');

            notificationMessage.textContent = message;
            notificationDiv.className = `notification ${type}`; // Use type for styling

            notificationDiv.style.display = 'block';

            // Hide the notification after 3 seconds
            setTimeout(() => {
                notificationDiv.style.display = 'none';
            }, 3000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            if (!checkAuth()) return;

            loadTodayMood();

            document.getElementById('logout-link').addEventListener('click', (event) => {
                event.preventDefault();
                logout();
            });

            document.getElementById('save-journal').addEventListener('click', () => {
                const entry = document.getElementById('journal-entry').value;
                // Placeholder for saving journal entry
                showNotification('Journal entry saved!', 'success');
            });
        });
    </script>
</body>
</html>
